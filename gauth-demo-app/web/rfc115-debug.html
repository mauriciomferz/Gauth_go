<!DOCTYPE html>
<html>
<head>
    <title>RFC115 Debug Test</title>
</head>
<body>
    <h1>RFC115 Response Debug Test</h1>
    <button onclick="testRFC115Response()">Test RFC115 Response Logic</button>
    <div id="output"></div>

    <script>
        function testRFC115Response() {
            // This is the exact response you reported as showing an error
            const data = {
                "compliance": {
                    "audit_trail": "enabled",
                    "legal_framework": "validated",
                    "rfc115_compliant": true
                },
                "delegation": {
                    "delegated_powers": [
                        "contract_signing",
                        "financial_transactions", 
                        "legal_representation"
                    ],
                    "enhanced": false,
                    "protocol": "RFC115",
                    "timestamp": "2025-09-28T18:19:11+02:00",
                    "type": "power_delegation"
                },
                "message": "RFC115 delegation processed successfully",
                "principal": "",
                "success": true
            };

            console.log('Testing RFC115 Response Data:', data);
            console.log('Success field:', data.success);
            console.log('Success type:', typeof data.success);
            console.log('Message field:', data.message);
            console.log('Delegation field:', data.delegation);
            
            // Check for success - be more explicit about success conditions
            const condition1 = (data.success === true);
            const condition2 = (data.success === 'true');
            const condition3 = (data.delegation_id);
            const condition4 = (data.delegation && Object.keys(data.delegation).length > 0);
            const condition5 = (data.message && data.message.includes('successfully'));
            
            console.log('Success conditions:', {condition1, condition2, condition3, condition4, condition5});
            
            const isSuccessful = condition1 || condition2 || condition3 || condition4 || condition5;
            console.log('Final isSuccessful:', isSuccessful);
            
            const output = document.getElementById('output');
            output.innerHTML = `
                <h2>Debug Results:</h2>
                <p><strong>Success field:</strong> ${data.success} (${typeof data.success})</p>
                <p><strong>Message:</strong> ${data.message}</p>
                <p><strong>Condition 1 (success === true):</strong> ${condition1}</p>
                <p><strong>Condition 2 (success === 'true'):</strong> ${condition2}</p>
                <p><strong>Condition 3 (delegation_id exists):</strong> ${condition3}</p>
                <p><strong>Condition 4 (delegation object exists):</strong> ${condition4}</p>
                <p><strong>Condition 5 (message includes 'successfully'):</strong> ${condition5}</p>
                <p><strong>Final Result:</strong> ${isSuccessful ? 'SUCCESS ✅' : 'ERROR ❌'}</p>
            `;

            if (isSuccessful) {
                const delegationId = data.delegation?.delegation_id || data.delegation_id || 'Generated successfully';
                const complianceLevel = data.compliance?.rfc115_compliant ? 'RFC115 Compliant' : (data.compliance_status?.compliance_level || 'Validated');
                const attestationLevel = data.enhanced_token?.attestations?.[0]?.trust_level || data.delegation?.type || 'Enhanced';
                
                alert(`✅ RFC115 Success!\n\nDelegation: ${delegationId}\n\nCompliance: ${complianceLevel}\nProtocol: ${data.delegation?.protocol || 'RFC115'}\n\n⚖️ ${data.message || 'Board Chair successfully delegated governance powers with enhanced attestation!'}`);
            } else {
                // This should only show for actual errors
                console.error('RFC115 Error - showing detailed response:', data);
                alert(`❌ RFC115 Error: ${JSON.stringify(data, null, 2)}`);
            }
        }
    </script>
</body>
</html>